The goal of this script is to (a) extract the info of some core clock genes and flowering-related genes and to (b) visualize the expression patterns.


# 0. Loading packages
```{r}
library(edgeR)
library(data.table)

```


# 1. PreProcessing
### Import the data and creat a DGEList object:
```{r}
counts <- read.delim("C:/Users/Po-Kai/Dropbox/Working/Mimulus_project/RNAseq/all_counts.txt", row.names = 1)

d0 <- DGEList(counts)


# Add sample-level info:
group <- as.factor(c(paste("c",rep(1:9, each=4), sep=""),paste("f",rep(1:9, each=4), sep="")))
d0$samples$group <- group

#ZT_vector <- c(14,17,20,23,2,5,8,11,14)
ZT_vector <- c(-10,-7,-4,-1,2,5,8,11,14)
d0$samples$ZT <- rep(rep(ZT_vector, each=4),2)

trt <- as.factor(c(rep(c("c","f"),each=36)))
d0$samples$trt <- trt

```


### Filter the data:
Use the `filterByExpr` function in the `edgeR` package to do the filtering. (20190419)
```{r}
keep.exprs <- filterByExpr(d0,group=d0$samples$group)
#keep.exprs <- filterByExpr(d0)
# These two are the same if I've set the `group=d0$samples$group`.

d0_filterByExpr <- d0[keep.exprs, , keep.lib.sizes=FALSE]
dim(d0_filterByExpr)
```


### Normalized the data
```{r}
d0_filterByExpr <- calcNormFactors(d0_filterByExpr)
```



# 2. Subset the data
```{r}
genes <- c("Migut.N01518.v2.0",
           "Migut.D01764.v2.0", "Migut.I00209.v2.0",
           "Migut.F00152.v2.0", "Migut.F00987.v2.0",
           "Migut.L01650.v2.0", "Migut.J00402.v2.0")

cpm_filtered <- as.data.frame(cpm(d0_filterByExpr))
pre_target<-cpm_filtered [row.names(cpm_filtered )%in%genes,]

# transpose
target <- transpose(pre_target)

# get row and colnames in order
colnames(target) <- rownames(pre_target)
rownames(target) <- colnames(pre_target)


target$ZT<-rep(rep(ZT_vector, each=4),2)
target$trt <- trt
target$group <- group
```
> In fact, I can transpose all -> choose the genes I want.


# 3. Plots!
### LHY
```{r}
gene.now <- "Migut.N01518.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```

### TOC1: Migut.D01764
```{r}
gene.now <- "Migut.D01764.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```

### TOC1: Migut.I00209
```{r}
gene.now <- "Migut.I00209.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```


### TOC1: Migut.I00209 (modified by Dan)
```{r}
gene.now <- "Migut.I00209.v2.0"
make_timecourse_plot = function(gene.now, common_name = NULL){
  means<- tapply(target[,gene.now], target$group,mean)
  means_data = data.frame(means)
  trt2 <- rep (c("c","f"), each = 9)
  means_data$trt <- trt2
  
  ZT2 <- rep(ZT_vector, 2)
  means_data$ZT <- ZT2
  
  
  library(ggplot2)
  p = ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
    ggtitle(paste(gene.now,common_name)) +
    geom_point(aes(color=trt)) +
    geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 
  p
}
```
```{r}
p = make_timecourse_plot("Migut.I00209.v2.0",'TOC1')
print(p)
make_timecourse_plot("Migut.F00152.v2.0",'PRR5')
make_timecourse_plot("Migut.F00987.v2.0",'PRR5')


```



### PRR5: Migut.F00152
```{r}
gene.now <- "Migut.F00152.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```
### PRR5: Migut.F00987
```{r}
gene.now <- "Migut.F00987.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```

### PRR7: Migut.L01650
```{r}
gene.now <- "Migut.L01650.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```

### PRR7: Migut.J00402
```{r}
gene.now <- "Migut.J00402.v2.0"
means<- tapply(target[,gene.now], target$group,mean)
means_data = data.frame(means)
trt2 <- rep (c("c","f"), each = 9)
means_data$trt <- trt2

ZT2 <- rep(ZT_vector, 2)
means_data$ZT <- ZT2


library(ggplot2)
ggplot(data=target, aes(x = target$ZT,y= target[,gene.now])) +
  geom_point(aes(color=trt)) +
  geom_line(data=means_data,aes(x=ZT,y=means, color=trt)) 


```